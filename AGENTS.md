# 项目协作指南（适用于全仓库）

## 1. 工具与信息获取

- 遇到新的框架和不了解的内容，优先使用 `context7` 获取使用信息。
- UI 相关默认使用 `shadcn/ui`，并且组件尽量只用 shadcn 原生组件。

## 2. 代码风格与工程文化

- 第一性原理：快速直接解决问题，拒绝过度设计，保证稳定、简洁、可维护。
- 改动要精简且针对性强，避免破坏既有功能与风格统一。
- 分层设计：调用链单向，保持抽象层清晰。

## 3. 日志与注释

- 日志优先使用英文。
- 注释优先中文，简洁有效，关键场景补充即可。

## 4. Java 规范（涉及 Java 代码时生效）

- public 函数必须有 Javadoc 注释；类文件顶部需包含功能/作者/创建时间注释（日期用当天）。
- 单行也必须写大括号。
- 禁止使用全限定名；禁止 `import *`。
- 单个 class 不超过 300 行；单个函数不超过 30 行；复杂逻辑拆分多 class 组合复用。

## 5. 会话与操作约束

- 对话优先中文展示。
- 禁止执行 `git add` / `git commit`，也不要提示用户执行这些命令。

## 6. 本仓库常规自检（每次修改后）

- Go：优先执行 `gofmt` 与 `go test ./...`，保证编译通过。

## 7. stats 并发上报（约定）

- Redis 上报改为“按文件合并”：每次上报先读取 Redis 现有 JSON，仅覆盖本机有输出的文件项，避免多个电脑互相覆盖进度；随后重算 totals/overall 并原子写入。
- 原子性：使用 Redis `WATCH + TxPipelined` + 重试，防止并发丢写；出现进度回退会被抑制（新 processed < 旧值不覆盖）。
- 兼容性：JSON 结构与旧版一致；仅在内存结构里增加 `FileProgress.HasOutput`（不序列化）。
- 建议：不同数据集可用不同 `REDIS_KEY` 隔离（例如 `58tong.progress`）。
