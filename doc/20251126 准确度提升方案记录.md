## 1 输入文本清洗

- 去除模板化句子
- 去除无关内容
- 正则化处理数字、符号、时间、薪资
- 对行业关键词做标准化（如“网络攻防/渗透测试/红队”归一到同一词典形式）

减少 embedding 模型的语义噪声，使向量更“专注”职业本体。

效果待验证
## 2 知识图谱 (已经完成)


### 2.1 对每个职业做向量检索，找 top-N “邻居”

对 classification.json. 每个职业 embedding v_i：

- 在职业库中用 cosine 搜索
- 去掉自己
- 取 top-N（常用 N=10 或 15）

得到结构：

neighbors[i] = [(j1, score1), (j2, score2), ..., (jN, scoreN)]

### 2.2 构建图的边

点：职业  
边：职业 i → 职业 j（带权重 score）

图的数据结构可以是 JSON 或 adjacency list。

典型 JSON 格式：

```
{  
"3-01-03-02劳动人事争议仲裁员": {  
"vector": [...],  
"neighbors": [  
{ "id": "某岗位A", "score": 0.87 },  
{ "id": "某岗位B", "score": 0.82 },  
{ "id": "某岗位C", "score": 0.79 }  
]  
},  
...  
}
```

注意：  
邻居边是无向还是有向都可以，用余弦相似度图大多是有向的（i 的邻居不一定有 j 的邻居里包含 i）。

### 2.3 图谱落地存储方式

SQLite 表  
一张表：

- job_id
- neighbor_id
- score

查询直接 SQL 取邻居。

![[attachments/6a2d640062f49b0de4fa70c99a631e05_MD5.png]]

### 2.4 在检索时如何使用图谱

当前的逻辑是 JD → embedding → cosine 搜索 → 得到 top1 , <mark style="background: #FFB86CA6;">但 top1 有时是错的（如“网络安全工程师”被误命中为“系统管理员”）</mark>。 语义图谱修正流程如下：

1. 取普通搜索得到的 top1（职业 A）
2. 从图谱中取出 A 的 k 个邻居（如 5 个）
3. 用 JD 向量依次与这些邻居做“二次相似度比较”
4. 如果邻居 B 的相似度比职业 A 高，则将匹配结果切换成 B


## 3 句子级拆分 → 聚合


用规则或标点将 JD 分成职责句子
对每句话单独生成 embedding

使用 mean pooling 或 max pooling 组合成最终向量
- mean → 更稳
- max → 更强调关键句子（例如 JD 中出现“渗透测试”）


减少长文本 embedding 的失真，使语义集中。

## 4 关键词加权增强


提取关键词（使用本地 TF-IDF 或词频统计即可）

将关键词各自 embedding 求平均

将“全文 embedding”与“关键词 embedding”按权重合并
final_vec = 0.7 * emb(full) + 0.3 * emb(keywords_avg)

能提高模型对 JD 关键职责的敏感性


## 5 职业库向量的多视角表达 (已经完成)




## 6 向量归一化策略升级

当前使用 L2-normalization，但可以加入以下改进：

- 对维度做 small-norm clipping，避免极端值
- 对 embedding 做均值中心化（zero mean）
- 对低方差维度做缩放抑制


